!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t);var o=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentID=0,this.logs=[],this.enabled=t}var t,n,o;return t=e,(n=[{key:"push",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.enabled&&(e.ID=++this.currentID,this.logs.push(e))}},{key:"doing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.push({doing:e})}},{key:"getLast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.logs.slice(-e)}},{key:"logLast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;console.log(this.getLast(e))}},{key:"get",value:function(){return this.logs}},{key:"log",value:function(){console.log(this.logs)}},{key:"debug",value:function(e){GAME.options.debugMode&&console.log("DEBUG LOG: "+e)}},{key:"debugWarning",value:function(e){GAME.options.debugMode&&console.warn("DEBUG LOG: "+e)}},{key:"debugError",value:function(e){GAME.options.debugMode&&console.error("DEBUG LOG: "+e)}}])&&i(t.prototype,n),o&&i(t,o),e}();function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"moveObjectTo",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=t.subtract(e.position).normalize(),o=Math.atan2(-1*i.x,-1*i.z);e.rotation.y=o,e.moveWithCollisions(i.multiplyByFloats(n,n,n))}},{key:"moveObjectBackFrom",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.moveObjectTo(e,t,-n)}}])&&s(t.prototype,n),i&&s(t,i),e}();function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.scene=t.scene,this.mesh=null,this.maxDistanceFromCenter=t.enemyDistanceFromCenter,this.defaultAltitude=2.5,this.speed=.4,this.attackSound=this.level.assets.getSound("monsterAttack"),this.states={DESTROYED:!1,FOLLOWING:!1,ATTACKING:!1,CLOSE_TO_PLAYER:!1}}var t,n,i;return t=e,(n=[{key:"create",value:function(){return this.mesh=this.level.assets.getMesh("enemy").clone(),this.mesh.enemyObject=this,this.mesh.checkCollisions=!0,BABYLON.Tags.AddTagsTo(this.mesh,"enemy"),this.mesh.position.x=Math.floor(100*Math.random())-50,this.mesh.position.z=Math.floor(100*Math.random())-50,this.mesh.position.y=this.defaultAltitude,this.mesh.scaling=new BABYLON.Vector3(.25,.25,.25),this.generateRandomPosition(),this}},{key:"move",value:function(){if(this.mesh&&!this.states.DESTROYED){var e=this.level.camera.position.subtract(this.mesh.position).length();e<=5?this.attack(e):e<=27?this.followPlayer():this.gotToRandomDirection()}}},{key:"followPlayer",value:function(){this.states.ATTACKING=!1,this.states.FOLLOWING=!0,GAME.helper.moveObjectTo(this.mesh,this.level.camera.position,this.speed)}},{key:"attack",value:function(e){this.states.FOLLOWING=!1,this.states.ATTACKING||(this.attackSound.play(),this.states.ATTACKING=!0),e>3&&GAME.helper.moveObjectTo(this.mesh,this.level.camera.position,2*this.speed),this.checkAttackedThePlayer(e)}},{key:"checkAttackedThePlayer",value:function(e){this.states.ATTACKING&&(e<=3.5?(this.states.CLOSE_TO_PLAYER||this.level.playerWasAttacked(),this.states.CLOSE_TO_PLAYER=!0):this.states.CLOSE_TO_PLAYER=!1)}},{key:"gotToRandomDirection",value:function(){GAME.helper.moveObjectTo(this.mesh,this.randPosition,this.speed),this.randPosition.subtract(this.mesh.position).length()<=1&&this.generateRandomPosition()}},{key:"generateRandomPosition",value:function(){var e=Math.floor(Math.random()*this.maxDistanceFromCenter)-this.maxDistanceFromCenter/2,t=Math.floor(Math.random()*this.maxDistanceFromCenter)-this.maxDistanceFromCenter/2;this.randPosition=new BABYLON.Vector3(e,this.defaultAltitude,t)}},{key:"destroy",value:function(){this.level.playerHitEnemy(),this.states.DESTROYED=!0,this.level.interpolate(this.mesh.position,"y",.5,100*this.mesh.position.y),this.remove()}},{key:"remove",value:function(){var e=this;this.mesh&&setTimeout(function(){e.mesh.dispose(),e.mesh=null},300)}}])&&a(t.prototype,n),i&&a(t,i),e}();function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentControlID=0,this.controls=[],this.menuTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(t)}var t,n,i;return t=e,(n=[{key:"addButton",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=BABYLON.GUI.Button.CreateSimpleButton(e,t);return i.width=n.width||.5,i.height=n.height||"60px",i.color=n.color||"black",i.outlineWidth=n.outlineWidth||0,i.outlineColor=n.outlineColor||i.color,i.alpha=void 0!==n.alpha?i.alpha:1,i.background=n.background||"white",i.left=n.left||"0px",i.top=n.top||"0px",i.textHorizontalAlignment=void 0!==n.horizontalAlignment?n.horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,i.textVerticalAlignment=void 0!==n.verticalAlignment?n.verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,n.onclick&&i.onPointerUpObservable.add(n.onclick),this.menuTexture.addControl(i),this.add(i),i}},{key:"addText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new BABYLON.GUI.TextBlock;return n.text=e,n.color=t.color||"white",n.fontSize=t.fontSize||28,n.outlineWidth=t.outlineWidth||0,n.outlineColor=t.outlineColor||"black",n.lineSpacing=t.lineSpacing||"5px",n.left=t.left||"0px",n.top=t.top||"0px",n.textHorizontalAlignment=void 0!==t.horizontalAlignment?t.horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,n.textVerticalAlignment=void 0!==t.verticalAlignment?t.verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,n.textWrapping=t.wrapping||!0,this.menuTexture.addControl(n),this.add(n),n}},{key:"addImage",value:function(e,t,n){var i=new BABYLON.GUI.Image(e,t);return i.stretch=BABYLON.GUI.Image.STRETCH_UNIFORM,i.width=n.width,i.height=n.height,i.left=n.left||"0px",i.top=n.top||"0px",i.textHorizontalAlignment=void 0!==n.horizontalAlignment?n.horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,i.textVerticalAlignment=void 0!==n.verticalAlignment?n.verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,this.menuTexture.addControl(i),this.add(i),i}},{key:"add",value:function(e){e.uiControlID=this.currentControlID++,this.controls.push(e)}},{key:"remove",value:function(e){e.isVisible=!1,this.controls.splice(e.uiControlID,1)}},{key:"show",value:function(){this.controls.forEach(function(e){return e.isVisible=!0})}},{key:"hide",value:function(){this.controls.forEach(function(e){return e.isVisible=!1})}}])&&u(t.prototype,n),i&&u(t,i),e}();function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.scene=t.scene,this.fireRate=350,this.canFire=!0,this.currentFireRate=0,this.shots=0,this.ammo=10,this.fireSound=this.level.assets.getSound("shotgun"),this.reloadSound=this.level.assets.getSound("reload"),this.emptySound=this.level.assets.getSound("empty"),this.states={EMPTY:!1}}var t,n,i;return t=e,(n=[{key:"create",value:function(){this.mesh=this.level.assets.getAnimatedMesh("rifle"),this.mesh.setEnabled(!0),this.mesh.isVisible=!0;var e=new BABYLON.TransformNode("weaponTransformNode");e.parent=this.level.camera,e.scaling=new BABYLON.Vector3(3.5,3.5,3.5),e.position=new BABYLON.Vector3(.7,-.45,1.1),this.mesh.parent=e,this.controlFireRate()}},{key:"fire",value:function(){if(1==this.ammo)this.states.EMPTY||(this.level.ammoIsOver(),this.states.EMPTY=!0);else if(this.ammo<=0)return void this.emptySound.play();var e=this.scene.getEngine().getRenderWidth(),t=this.scene.getEngine().getRenderHeight();if(this.level.controlEnabled){var n=this.scene.pick(e/2,t/2,null,!1,this.camera);this.doFire(n)}}},{key:"doFire",value:function(e){if(this.canFire){if(this.ammo--,this.shots++,this.fireSound.play(),this.level.updateStats(),e.hit&&BABYLON.Tags.HasTags(e.pickedMesh)&&e.pickedMesh.matchesTagsQuery("enemy"))(e.pickedMesh.parent?e.pickedMesh.parent:e.pickedMesh).enemyObject.destroy();else if(e.pickedPoint)BABYLON.Mesh.CreateBox("box",.1,this.scene).position=e.pickedPoint.clone();this.animateFire(),this.canFire=!1}}},{key:"animateFire",value:function(){this.level.assets.playMeshAnimation("rifle",0,10)}},{key:"reload",value:function(){this.ammo+=10,this.states.EMPTY=!1,this.level.assets.playMeshAnimation("rifle",11,72),this.reloadSound.play(),this.level.updateStats()}},{key:"controlFireRate",value:function(){this.canFire||(this.currentFireRate-=GAME.engine.getDeltaTime(),this.currentFireRate<=0&&(this.canFire=!0,this.currentFireRate=this.fireRate))}}])&&h(t.prototype,n),i&&h(t,i),e}();function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.scene=t.scene,this.hits=0,this.points=0,this.pointsRecord=!1,this.initialTime=null,this.endTime=null,this.elapsedTime=0}var t,n,i;return t=e,(n=[{key:"startTimeCounter",value:function(){this.initialTime=new Date,this.elapsedTime=0}},{key:"stopTimeCounter",value:function(){this.endTime=new Date,this.elapsedTime=(this.endTime-this.initialTime)/1e3}},{key:"getPoints",value:function(){return this.points}},{key:"calculatePoints",value:function(){var e=this.elapsedTime||1;return this.points=100*this.hits,this.points=e<this.points?this.points-e:this.points,this.points=this.points-this.level.weapon.shots,this.points=parseInt(this.points,10),this.points=this.points>0?this.points:this.hits,this.checkAndSaveRecord(this.points),this.points}},{key:"checkAndSaveRecord",value:function(e){var t=0;this.pointsRecord=!1,window.localStorage.last_record&&(t=parseInt(window.localStorage.last_record,10)),t<e&&(this.pointsRecord=!0,window.localStorage.last_record=e)}},{key:"hasMadePointsRecord",value:function(){return this.pointsRecord}},{key:"getLastRecord",value:function(){return window.localStorage.last_record||0}}])&&m(t.prototype,n),i&&m(t,i),e}();function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.meshes=[],this.sounds=[],this.animatedMeshes=[],this.manager=new BABYLON.AssetsManager(this.scene),this.manager.onFinish=function(e){n&&n(e)}}var t,n,i;return t=e,(n=[{key:"addSound",value:function(e,t,n){var i=this;return this.manager.addBinaryFileTask(e+"__SoundTask",t).onSuccess=function(t){i.sounds[e]=new BABYLON.Sound(e,t.data,i.scene,null,n),n.onSuccess&&n.onSuccess(i.sounds[e])},this.sounds[e]}},{key:"addMusic",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.loop=void 0===n.loop||n.loop,n.volume=void 0!==n.volume?n.volume:.5,n.autoplay=void 0===n.autoplay||n.autoplay,this.addSound(e,t,n)}},{key:"addMergedMesh",value:function(e,t,n){return this.addMesh(e,t,n,!0)}},{key:"addMesh",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.manager.addMeshTask(e+"__MeshTask","",t).onSuccess=function(t){var s=null;try{(s=o?BABYLON.Mesh.MergeMeshes(t.loadedMeshes):t.loadedMeshes[0]).setEnabled(!1),n.meshes[e]=s,i.onSuccess&&i.onSuccess(n.meshes[e])}catch(e){console.error(e)}},this.meshes[e]}},{key:"addAnimatedMesh",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.manager.addMeshTask(e+"__AnimatedMeshTask","",t).onSuccess=function(t){try{var o=t.loadedMeshes[0];o.setEnabled(!1),n.animatedMeshes[e]=n.buildAnimatedMeshData(o,t,i),i.onSuccess&&i.onSuccess(n.animatedMeshes[e])}catch(e){console.error(e)}},this.animatedMeshes[e]}},{key:"buildAnimatedMeshData",value:function(e,t,n){var i=0,o=0;return(n.start||n.startFrame)&&(i=n.startFrame?n.startFrame/30:n.start,o=n.endFrame?n.endFrame/30:n.end),e.animationGroups=t.loadedAnimationGroups,e.animationGroups.forEach(function(e){n.normalized&&e.normalize(i,o),e.pause()}),e}},{key:"playMeshAnimation",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var i=this.getAnimatedMesh(e);t/=30,n/=30,i.animationGroups.forEach(function(e){e.stop(),e.start(!1,1,t,n)})}},{key:"getMesh",value:function(e){if(this.meshes[e])return this.meshes[e];GAME.log.debugError('There is no mesh called "'+e+'"')}},{key:"getAnimatedMesh",value:function(e){if(this.animatedMeshes[e])return this.animatedMeshes[e];GAME.log.debugError('There is no animated mesh called "'+e+'"')}},{key:"getSound",value:function(e){return this.sounds[e]}},{key:"load",value:function(){this.manager.load()}}])&&p(t.prototype,n),i&&p(t,i),e}();function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.materials={},this.scene=null,this.assets=null}var t,n,i;return t=e,(n=[{key:"start",value:function(){this.setProperties?this.setProperties():GAME.log.debugWarning("The setProperties method is recommended to initialize the Level properties"),this.createScene()}},{key:"createScene",value:function(){var e=this;return this.scene=new BABYLON.Scene(GAME.engine),this.assets=new v(this.scene,function(){GAME.log.debug("Level Assets loaded"),e.buildScene?e.buildScene():GAME.log.debugWarning("You can add the buildScene method to your level to define your scene"),e.beforeRender?e.scene.registerBeforeRender(e.beforeRender.bind(e)):GAME.log.debugWarning("You can define animations and other game logics that happens inside the main loop on the beforeRender method"),GAME.resume(),GAME.startRenderLoop()}),this.setupAssets&&this.setupAssets(),this.assets.load(),this.scene}},{key:"exit",value:function(){GAME.canvas.blur(),GAME.stopRenderLoop(),this.onExit&&this.onExit(),this.scene.dispose(),this.scene=null}},{key:"addCollider",value:function(e,t){var n=BABYLON.MeshBuilder.CreateBox(e,{width:t.width||1,height:t.height||1,depth:t.depth||1},this.scene);if(BABYLON.Tags.AddTagsTo(n,"collider boxCollider"),n.position.x=t.positionX||0,n.position.y=t.positionY||0,n.position.z=t.positionZ||0,n.isVisible=!!t.visible&&t.visible,n.isVisible){var i=new BABYLON.StandardMaterial(e+"Material");i.diffuseColor=new BABYLON.Color3(.5,.5,0),i.alpha=.5,n.material=i}return t.timeToDispose=t.timeToDispose?t.timeToDispose:0,n.actionManager=new BABYLON.ActionManager(this.scene),n.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnIntersectionEnterTrigger,parameter:t.collisionMesh},function(){t.onCollide&&t.onCollide(),t.disposeAfterCollision&&setTimeout(function(){n.dispose()},t.timeToDispose)})),n}},{key:"disposeColliders",value:function(){for(var e=this.scene.getMeshesByTags("collider"),t=0;t<e.length;t++)e[t].dispose()}},{key:"addMaterial",value:function(e){this.materials[e.name]=e}},{key:"getMaterial",value:function(e){return this.materials[e]}},{key:"removeMaterial",value:function(e){var t=null;(t=this.materials[e])&&(t.dispose(),delete this.materials[e])}},{key:"interpolate",value:function(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.scene.actionManager||(this.scene.actionManager=new BABYLON.ActionManager(this.scene));var s=new BABYLON.InterpolateValueAction(BABYLON.ActionManager.NothingTrigger,e,t,n,i);s.onInterpolationDoneObservable.add(function(){GAME.log.debug("Interpolation done"),o&&o()}),this.scene.actionManager.registerAction(s),s.execute()}},{key:"enablePointerLock",value:function(){var e=this,t=GAME.canvas;this.camera||console.error("You need to add a camera to the level to enable pointer lock"),t.addEventListener("click",function(e){t.requestPointerLock=t.requestPointerLock||t.msRequestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock&&t.requestPointerLock()},!1);var n=function(n){e.controlEnabled=document.mozPointerLockElement===t||document.webkitPointerLockElement===t||document.msPointerLockElement===t||document.pointerLockElement===t,e.controlEnabled?e.camera.attachControl(t):e.camera.detachControl(t)};document.addEventListener("pointerlockchange",n,!1),document.addEventListener("mspointerlockchange",n,!1),document.addEventListener("mozpointerlockchange",n,!1),document.addEventListener("webkitpointerlockchange",n,!1)}},{key:"exitPointerLock",value:function(){this.camera.detachControl(GAME.canvas)}}])&&y(t.prototype,n),i&&y(t,i),e}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function b(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var B=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),b(this,L(t).apply(this,arguments))}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(t,g),n=t,(i=[{key:"setProperties",value:function(){this.menu=null,this.weapon=null,this.ammoBox=null,this.player=new f(this),this.playerMesh=null,this.playerLife=100,this.maxEnemies=10,this.currentEnemies=0,this.enemies=[],this.enemyDistanceFromCenter=100}},{key:"setupAssets",value:function(){this.assets.addAnimatedMesh("rifle","/assets/models/weapons/rifle/rifle.gltf",{normalized:!0,start:0,end:207}),this.assets.addMergedMesh("enemy","/assets/models/skull/skull2.obj"),this.assets.addMusic("music","/assets/musics/music.mp3",{volume:.1}),this.assets.addSound("shotgun","/assets/sounds/shotgun.wav",{volume:.4}),this.assets.addSound("reload","/assets/sounds/reload.mp3",{volume:.4}),this.assets.addSound("empty","/assets/sounds/empty.wav",{volume:.4}),this.assets.addSound("monsterAttack","/assets/sounds/monster_attack.wav",{volume:.3}),this.assets.addSound("playerDamaged","/assets/sounds/damage.wav",{volume:.3})}},{key:"buildScene",value:function(){var e=this;this.scene.clearColor=new BABYLON.Color3.FromHexString("#777"),new BABYLON.DirectionalLight("DirectionalLight",new BABYLON.Vector3(0,-1,0),this.scene).intensity=.3,new BABYLON.HemisphericLight("HemiLight",new BABYLON.Vector3(0,1,0),this.scene).intensity=.5;var t=BABYLON.MeshBuilder.CreateBox("skyBox",{size:1e3},this.scene),n=new BABYLON.StandardMaterial("skyBox",this.scene);n.backFaceCulling=!1,n.reflectionTexture=new BABYLON.CubeTexture("assets/skybox/skybox",this.scene),n.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,n.disableLighting=!0,t.material=n,this.scene.gravity=new BABYLON.Vector3(0,-9.81,0),this.scene.collisionsEnabled=!0,this.camera=this.createCamera(),this.scene.activeCamera=this.camera,this.enablePointerLock(),this.createGround(),this.addWeapon(),this.addEnemies(),this.createHUD(),this.createMenu(),setInterval(function(){e.addEnemies()},25e3),this.setupEventListeners(),this.player.startTimeCounter()}},{key:"createGround",value:function(){var e=BABYLON.Mesh.CreateGround("ground",500,500,2,this.scene);e.checkCollisions=!0;var t=new BABYLON.StandardMaterial("groundMaterial",this.scene);t.diffuseTexture=new BABYLON.Texture("/assets/images/sand.jpg",this.scene),t.specularColor=new BABYLON.Color3(0,0,0),e.material=t}},{key:"addWeapon",value:function(){this.weapon=new d(this),this.weapon.create()}},{key:"addEnemies",value:function(){this.removeUnnecessaryEnemies();for(var e=this.maxEnemies-this.currentEnemies,t=0;t<e;t++){var n=new l(this).create();this.enemies.push(n),this.currentEnemies++}this.maxEnemies+=1,this.enemyDistanceFromCenter+=10}},{key:"removeUnnecessaryEnemies",value:function(){for(var e=this.enemies.length,t=0;t<e;t++)this.enemies[t]&&!this.enemies[t].mesh&&this.enemies.splice(t,1)}},{key:"setupEventListeners",value:function(){var e=this;GAME.canvas.addEventListener("click",function(){e.weapon&&e.weapon.fire()},!1)}},{key:"createHUD",value:function(){var e=new c("levelUI");e.addImage("gunsight","/assets/images/gunsight.png",{width:.05,height:.05}),this.lifeTextControl=e.addText("Life: "+this.playerLife,{top:"10px",left:"10px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT}),this.ammoTextControl=e.addText("Ammo: "+this.weapon.ammo,{top:"10px",left:"10px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER}),this.hitsTextControl=e.addText("Hits: "+this.player.hits,{top:"10px",left:"-10px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT})}},{key:"createMenu",value:function(){var e=this;this.menu=new c("runnerMenuUI"),this.pointsTextControl=this.menu.addText("Points: 0",{top:"-200px",outlineWidth:"2px",fontSize:"40px",verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER}),this.currentRecordTextControl=this.menu.addText("Current Record: 0",{top:"-150px",verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER}),this.hasMadeRecordTextControl=this.menu.addText("You got a new Points Record!",{top:"-100px",color:GAME.options.recordTextColor,fontSize:"20px",verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER}),this.gameOverTextControl=this.menu.addText("GAME OVER",{top:"-60px",color:GAME.options.recordTextColor,fontSize:"25px",verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER}),this.menu.addButton("replayButton","Replay Game",{onclick:function(){return e.replay()}}),this.menu.addButton("backButton","Return to Home",{top:"70px",onclick:function(){return GAME.goToLevel("HomeMenuLevel")}}),this.menu.hide()}},{key:"createCamera",value:function(){var e=this,t=new BABYLON.UniversalCamera("UniversalCamera",new BABYLON.Vector3(0,3.5,100),this.scene);return t.setTarget(new BABYLON.Vector3(0,2,0)),t.attachControl(GAME.canvas,!0),t.applyGravity=!0,t.ellipsoid=new BABYLON.Vector3(1,1.7,1),t.checkCollisions=!0,t._needMoveForGravity=!0,this.addEnemies(),t.minZ=0,t.keysUp=[87,38],t.keysDown=[83,40],t.keysLeft=[65,37],t.keysRight=[68,39],t.inertia=.1,t.angularSensibility=800,t.speed=17,t.onCollide=function(t){"ammoBox"==t.id&&(e.weapon.reload(),t.dispose(),t.arrow.dispose())},t}},{key:"playerWasAttacked",value:function(){if(this.playerLife-=5,this.playerLife<=0)return this.playerLife=0,this.lifeTextControl.text="Life: "+this.playerLife,void this.gameOver();this.lifeTextControl.text="Life: "+this.playerLife,this.assets.getSound("playerDamaged").play()}},{key:"playerHitEnemy",value:function(){this.currentEnemies--,this.player.hits++,this.hitsTextControl.text="Hits: "+this.player.hits}},{key:"ammoIsOver",value:function(){this.addAmmoBox()}},{key:"addAmmoBox",value:function(){this.ammoBox=BABYLON.MeshBuilder.CreateBox("ammoBox",{width:4,height:2,depth:2},this.scene),this.ammoBox.position.x=0,this.ammoBox.position.y=1,this.ammoBox.position.z=0,this.ammoBox.checkCollisions=!0;var e=new BABYLON.SpriteManager("arrowSpriteManager","assets/images/arrow.png",1,256,this.scene);this.ammoBox.arrow=new BABYLON.Sprite("arrow",e),this.ammoBox.arrow.position.y=5,this.ammoBox.arrow.size=4}},{key:"updateStats",value:function(){this.lifeTextControl.text="Life: "+this.playerLife,this.ammoTextControl.text="Ammo: "+this.weapon.ammo,this.hitsTextControl.text="Hits: "+this.player.hits}},{key:"gameOver",value:function(){GAME.pause(),this.player.stopTimeCounter(),this.player.calculatePoints(),this.showMenu(),this.exitPointerLock(),this.enemies.forEach(function(e){return e.remove()}),this.removeUnnecessaryEnemies(),this.ammoBox&&(this.ammoBox.dispose(),this.ammoBox.arrow.dispose())}},{key:"showMenu",value:function(){this.pointsTextControl.text="Points: "+this.player.getPoints(),this.currentRecordTextControl.text="Current Record: "+this.player.getLastRecord(),this.menu.show(),this.player.hasMadePointsRecord()?this.hasMadeRecordTextControl.isVisible=!0:this.hasMadeRecordTextControl.isVisible=!1}},{key:"replay",value:function(){this.playerLife=100,this.player.hits=0,this.maxEnemies=10,this.currentEnemies=0,this.enemies=[],this.enemyDistanceFromCenter=100,this.updateStats(),GAME.resume(),this.menu.hide(),this.camera.position=new BABYLON.Vector3(0,3.5,100),this.weapon.reload(),this.addEnemies(),this.player.startTimeCounter()}},{key:"beforeRender",value:function(){GAME.isPaused()||(this.weapon.controlFireRate(),this.enemies.forEach(function(e){return e.move()}),this.camera.position.y<-20&&this.gameOver())}}])&&A(n.prototype,i),o&&A(n,o),t}();function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function E(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var x=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),E(this,M(t).apply(this,arguments))}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,g),n=t,(i=[{key:"setupAssets",value:function(){this.assets.addMusic("music","/assets/musics/music.mp3")}},{key:"buildScene",value:function(){new BABYLON.FreeCamera("camera1",new BABYLON.Vector3(0,5,-10),this.scene);this.scene.clearColor=new BABYLON.Color4(0,0,0,0),this.makeUI()}},{key:"makeUI",value:function(){var e=new c("creditsUI");e.addText("Design and Code by Tiago Silva Pereira Rodrigues\nkingofcode.com.br\n\n\n",{top:"30px",fontSize:"20px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_TOP}),e.addText("Music by Eric Matyas\nwww.soundimage.org",{top:"140px",fontSize:"20px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_TOP}),e.addText("Rifle model by 3DMaesen (bumstrum) under CC BY 4.0\nhttps://sketchfab.com/bumstrum",{top:"250px",fontSize:"20px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_TOP}),e.addText("Skybox Textures from BabylonJS\nhttps://doc.babylonjs.com/resources/playground_textures\n\nPlease check the license documentation before\nchanging the credits",{top:"360px",fontSize:"20px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_TOP}),e.addButton("backButton","Return to Home",{top:"0px",background:"transparent",color:"white",onclick:function(){return GAME.goToLevel("HomeMenuLevel")}})}}])&&O(n.prototype,i),o&&O(n,o),t}();function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function G(e,t){return!t||"object"!==N(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),G(this,I(t).apply(this,arguments))}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,g),n=t,(i=[{key:"setupAssets",value:function(){this.assets.addMusic("music","/assets/musics/music.mp3")}},{key:"buildScene",value:function(){new BABYLON.FreeCamera("camera1",new BABYLON.Vector3(0,5,-10),this.scene);this.scene.clearColor=new BABYLON.Color4(0,0,0,0);var e=new c("homeMenuUI");e.addButton("playButton","Play Game",{background:"transparent",color:"white",onclick:function(){return GAME.goToLevel("FirstLevel")}}),e.addButton("creditsButton","Credits",{top:"70px",background:"transparent",color:"white",onclick:function(){return GAME.goToLevel("CreditsLevel")}}),document.getElementById("forkMeOnGithub").style.display="block"}},{key:"onExit",value:function(){document.getElementById("forkMeOnGithub").style.display="none"}}])&&S(n.prototype,i),o&&S(n,o),t}();function Y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.keys={},this.paused=!1,this.log=new o,this.helper=new r,this.canvas=document.getElementById("renderCanvas"),this.engine=new BABYLON.Engine(this.canvas,!0),this.currentLevel=null,this.currentLevelName="HomeMenuLevel",this.levels={HomeMenuLevel:new P,CreditsLevel:new x,FirstLevel:new B}}var t,n,i;return t=e,(n=[{key:"start",value:function(){this.listenKeys(),this.lintenTouchEvents(),this.startLevel(),this.listenOtherEvents()}},{key:"pause",value:function(){this.paused=!0}},{key:"isPaused",value:function(){return this.paused}},{key:"resume",value:function(){this.paused=!1}},{key:"listenKeys",value:function(){document.addEventListener("keydown",function(e){87==e.keyCode||38==e.keyCode?this.keys.up=1:83==e.keyCode||40==e.keyCode?this.keys.down=1:65==e.keyCode||37==e.keyCode?this.keys.left=1:68!=e.keyCode&&39!=e.keyCode||(this.keys.right=1)}.bind(this)),document.addEventListener("keyup",function(e){87==e.keyCode||38==e.keyCode?this.keys.up=0:83==e.keyCode||40==e.keyCode?this.keys.down=0:65==e.keyCode||37==e.keyCode?this.keys.left=0:68!=e.keyCode&&39!=e.keyCode||(this.keys.right=0)}.bind(this)),this.keys.up=!1,this.keys.down=!1,this.keys.left=!1,this.keys.right=!1}},{key:"lintenTouchEvents",value:function(){var e=this;if("undefined"!=typeof Hammer){var t=new Hammer(document.body);t.get("swipe").set({direction:Hammer.DIRECTION_ALL}),t.on("swipeup",function(t){e.keys.up=1,setTimeout(function(){e.keys.up=0},150)}),t.on("swipedown",function(t){e.keys.down=1,setTimeout(function(){e.keys.down=0},100)}),t.on("swipeleft",function(t){e.keys.left=2,setTimeout(function(){e.keys.left=0},150)}),t.on("swiperight",function(t){e.keys.right=2,setTimeout(function(){e.keys.right=0},150)})}}},{key:"listenOtherEvents",value:function(){var e=this;window.addEventListener("blur",function(){e.pause()}),window.addEventListener("focus",function(){e.resume()}),window.addEventListener("resize",function(){e.engine.resize()})}},{key:"goToLevel",value:function(e){this.levels[e]?(this.currentLevel&&this.currentLevel.exit(),this.currentLevelName=e,this.startLevel()):console.error("A level with name "+e+" does not exists")}},{key:"startLevel",value:function(){this.currentLevel=this.levels[this.currentLevelName],this.currentLevel.start()}},{key:"render",value:function(){this.startRenderLoop()}},{key:"startRenderLoop",value:function(){var e=this;setTimeout(function(){e.engine.runRenderLoop(function(){e.currentLevel.scene.render()})},50)}},{key:"stopRenderLoop",value:function(){this.engine.stopRenderLoop()}},{key:"isMobile",value:function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}}])&&Y(t.prototype,n),i&&Y(t,i),e}();window.GAME=null;var D=function(){GAME=new _(window.initialGameOptions),GAME.start()};window.addEventListener("DOMContentLoaded",function(){D()})}]);